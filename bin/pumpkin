#!/usr/bin/env sh

set -eu
self=$(basename -- "$0")

help() {
  printf "? %s [commits] [branch]\n" "$self"
  exit 1
}

[ "$#" -lt 2 ] && help
case $1 in
  ''|*[!0-9]*) help ;;
esac

pwd
printf "about to squash %s commits from %s\n" "$1" "$2"
printf "proceed with squash procedure? (y/n) "

read -r answer
case $answer in
  [yY] )
    git reset --soft HEAD~"$1"
    printf "enter commit message: "
    read -r commit
    echo $commit
    git commit -a -m "$commit"
    git checkout master
    git pull origin master
    git checkout -
    git rebase master
    git push origin "$2" --force
    printf "done\n"
    ;;
  * ) printf "aborted\n" ;;
esac
